<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Circuit - Memory Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 400px;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(90deg, #06b6d4, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .header p {
            color: #94a3b8;
            font-size: 14px;
        }

        .game-box {
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.3);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .light {
            aspect-ratio: 1;
            border: 1px solid #475569;
            border-radius: 8px;
            background: linear-gradient(135deg, #334155, #1e293b);
            cursor: pointer;
            transition: all 100ms ease;
            font-size: 0;
        }

        .light:hover:not(:disabled) {
            background: linear-gradient(135deg, #475569, #334155);
        }

        .light:disabled {
            cursor: not-allowed;
        }

        .light.active-red {
            background: linear-gradient(135deg, #fca5a5, #ef4444);
            box-shadow: 0 0 20px #ef4444, inset 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .light.active-yellow {
            background: linear-gradient(135deg, #fde047, #eab308);
            box-shadow: 0 0 20px #eab308, inset 0 0 10px rgba(234, 179, 8, 0.5);
        }

        .light.active-green {
            background: linear-gradient(135deg, #86efac, #22c55e);
            box-shadow: 0 0 20px #22c55e, inset 0 0 10px rgba(34, 197, 94, 0.5);
        }

        .light.active-purple {
            background: linear-gradient(135deg, #c084fc, #a855f7);
            box-shadow: 0 0 20px #a855f7, inset 0 0 10px rgba(168, 85, 247, 0.5);
        }

        .light.active-orange {
            background: linear-gradient(135deg, #fdba74, #f97316);
            box-shadow: 0 0 20px #f97316, inset 0 0 10px rgba(249, 115, 22, 0.5);
        }

        .light.active-pink {
            background: linear-gradient(135deg, #f9a8d4, #ec4899);
            box-shadow: 0 0 20px #ec4899, inset 0 0 10px rgba(236, 72, 153, 0.5);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .stat {
            background: #334155;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #06b6d4;
        }

        .stat-value.mistakes {
            color: #f87171;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        button {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 200ms ease;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(90deg, #06b6d4, #3b82f6);
            color: white;
        }

        .btn-primary:hover {
            box-shadow: 0 15px 25px rgba(6, 182, 212, 0.4);
            transform: translateY(-2px);
        }

        .status-text {
            text-align: center;
            color: #cbd5e1;
            font-weight: 600;
            padding: 16px;
        }

        .game-over-box {
            background: #334155;
            border: 1px solid #f87171;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            margin-bottom: 12px;
        }

        .game-over-label {
            color: #f87171;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .game-over-score {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .game-over-value {
            font-size: 32px;
            font-weight: bold;
            color: #06b6d4;
        }

        .instructions {
            margin-top: 32px;
            background: #334155;
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 16px;
        }

        .instructions p {
            color: #cbd5e1;
            font-size: 12px;
            line-height: 1.6;
        }

        .instructions strong {
            color: #06b6d4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LIGHT CIRCUIT</h1>
            <p>Remember the pattern. Master your memory.</p>
        </div>

        <div class="game-box">
            <div class="grid" id="gameGrid"></div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Level</div>
                    <div class="stat-value" id="levelStat">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Round</div>
                    <div class="stat-value" id="roundStat">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Timer</div>
                    <div class="stat-value" id="timerStat">0s</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Mistakes</div>
                    <div class="stat-value mistakes" id="mistakesStat">0/2</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div id="gameControls">
                <button class="btn-primary" id="startBtn" onclick="startGame()">START GAME</button>
                <div class="status-text" id="statusText"></div>
            </div>
        </div>

        <div class="instructions">
            <p><strong>How to Play:</strong> Each level has 2 rounds with the same number of lights. <strong>Round 1:</strong> Many colored lights will flash - remember only the RED lights in sequence! <strong>Round 2:</strong> The grid rotates 90° or 180° - remember the pattern despite rotation! Complete both rounds to advance. Get 2 mistakes and it's game over. Timer tracks your performance!</p>
        </div>
    </div>

    <script>
        let sequence = [];
        let userSequence = [];
        let level = 1;
        let gameState = 'start';
        let mistakes = 0;
        let score = 0;
        let round = 1;
        let timer = 0;
        let timerInterval = null;

        const gameGrid = document.getElementById('gameGrid');
        const levelStat = document.getElementById('levelStat');
        const roundStat = document.getElementById('roundStat');
        const timerStat = document.getElementById('timerStat');
        const mistakesStat = document.getElementById('mistakesStat');
        const statusText = document.getElementById('statusText');
        const gameControls = document.getElementById('gameControls');

        const colors = ['red', 'yellow', 'green', 'purple', 'orange', 'pink'];
        let currentRotation = 0;

        // Create lights
        function createGrid() {
            gameGrid.innerHTML = '';
            for (let i = 0; i < 16; i++) {
                const light = document.createElement('button');
                light.className = 'light';
                light.onclick = () => handleLightClick(i);
                light.id = `light-${i}`;
                gameGrid.appendChild(light);
            }
        }

        // Flash a light
        async function flashLight(index, color = 'red') {
            const light = document.getElementById(`light-${index}`);
            light.classList.add(`active-${color}`);
            await sleep(500);
            light.classList.remove(`active-${color}`);
            await sleep(300);
        }

        // Sleep function
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Play sequence
        async function playSequence(seq) {
            disableAllLights(true);
            await sleep(500);

            if (round === 1) {
                // Round 1: Color distraction - flash many colors but only RED is correct
                const distractionCount = Math.min(10 - level, 8);
                const allFlashes = [...seq.map(i => ({index: i, color: 'red'}))];
                
                // Add distraction flashes
                for (let i = 0; i < distractionCount; i++) {
                    const randomIndex = Math.floor(Math.random() * 16);
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    if (randomColor !== 'red') {
                        allFlashes.push({index: randomIndex, color: randomColor});
                    }
                }

                // Shuffle all flashes
                allFlashes.sort(() => Math.random() - 0.5);

                // Play all flashes
                for (let flash of allFlashes) {
                    await sleep(600);
                    await flashLight(flash.index, flash.color);
                }
            } else {
                // Round 2: Same color, but with rotation distraction
                for (let i = 0; i < seq.length; i++) {
                    await sleep(600);
                    await flashLight(seq[i], 'red');
                }
            }

            await sleep(500);
            disableAllLights(false);
        }

        // Rotate grid
        function rotateGrid(degrees) {
            currentRotation = degrees;
            gameGrid.style.transform = `rotate(${degrees}deg)`;
            gameGrid.style.transition = 'transform 0.5s ease';
            
            // Counter-rotate each light to keep content upright
            for (let i = 0; i < 16; i++) {
                const light = document.getElementById(`light-${i}`);
                light.style.transform = `rotate(${-degrees}deg)`;
                light.style.transition = 'transform 0.5s ease';
            }
        }

        // Get rotated index
        function getRotatedIndex(index, degrees) {
            if (degrees === 0) return index;
            
            const row = Math.floor(index / 4);
            const col = index % 4;
            
            if (degrees === 90) {
                return col * 4 + (3 - row);
            } else if (degrees === 180) {
                return (3 - row) * 4 + (3 - col);
            } else if (degrees === 270) {
                return (3 - col) * 4 + row;
            }
            return index;
        }

        // Start/Stop Timer
        function startTimer() {
            timer = 0;
            timerStat.textContent = '0s';
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timer++;
                timerStat.textContent = `${timer}s`;
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Disable/Enable lights
        function disableAllLights(disabled) {
            for (let i = 0; i < 16; i++) {
                document.getElementById(`light-${i}`).disabled = disabled;
            }
        }

        // Handle light click
        async function handleLightClick(index) {
            if (gameState !== 'input') return;

            // Adjust for rotation in round 2
            let actualIndex = index;
            if (round === 2 && currentRotation !== 0) {
                actualIndex = getRotatedIndex(index, currentRotation);
            }

            await flashLight(actualIndex, 'red');
            const newUserSequence = [...userSequence, actualIndex];
            userSequence = newUserSequence;

            // Check if correct
            if (newUserSequence[newUserSequence.length - 1] !== sequence[newUserSequence.length - 1]) {
                // Wrong!
                mistakes++;
                mistakesStat.textContent = `${mistakes}/2`;
                if (mistakes >= 2) {
                    endGame();
                } else {
                    gameState = 'input';
                    statusText.textContent = 'Wrong! Try again...';
                    userSequence = [];
                }
                return;
            }

            // Check if completed sequence
            if (newUserSequence.length === sequence.length) {
                score = level;
                gameState = 'playing';
                statusText.textContent = 'Correct! Next round loading...';

                // Advance to next round or level
                if (round === 1) {
                    // Move to round 2 - same sequence, but with rotation
                    round = 2;
                    roundStat.textContent = '2';
                    await sleep(1000);
                    
                    // Apply rotation for round 2
                    const rotation = Math.random() < 0.5 ? 90 : 180;
                    rotateGrid(rotation);
                    
                    await sleep(1000);
                    startRound();
                } else {
                    // Move to next level
                    level++;
                    round = 1;
                    levelStat.textContent = level;
                    roundStat.textContent = '1';
                    rotateGrid(0);
                    sequence = [];
                    await sleep(1000);
                    startRound();
                }
            }
        }

        // Start round
        async function startRound() {
            gameState = 'playing';
            
            if (round === 1) {
                // Round 1: New sequence based on level
                statusText.textContent = `Round 1: Watch for RED lights (Level ${level})`;
                for (let i = 0; i < level; i++) {
                    sequence.push(Math.floor(Math.random() * 16));
                }
            } else {
                // Round 2: Same sequence with rotation
                statusText.textContent = `Round 2: Remember the pattern (Rotated!)`;
            }

            userSequence = [];
            await playSequence(sequence);
            gameState = 'input';
            
            if (round === 1) {
                statusText.textContent = 'Your turn! Click only the RED lights in order';
            } else {
                statusText.textContent = 'Your turn! Remember the rotation!';
            }
            
            startTimer();
        }

        // Start game
        function startGame() {
            sequence = [];
            userSequence = [];
            level = 1;
            round = 1;
            mistakes = 0;
            score = 0;
            currentRotation = 0;

            levelStat.textContent = '1';
            roundStat.textContent = '1';
            timerStat.textContent = '0s';
            mistakesStat.textContent = '0/2';

            rotateGrid(0);
            gameState = 'playing';
            startRound();
        }

        // End game
        function endGame() {
            gameState = 'gameOver';
            stopTimer();
            disableAllLights(true);
            rotateGrid(0);
            gameControls.innerHTML = `
                <div class="game-over-box">
                    <div class="game-over-label">GAME OVER</div>
                    <div class="game-over-score">Final Level</div>
                    <div class="game-over-value">Level ${level}</div>
                    <div class="game-over-score">Total Time</div>
                    <div class="game-over-value">${timer}s</div>
                </div>
                <button class="btn-primary" onclick="location.reload()">PLAY AGAIN</button>
            `;
        }

        // Initialize
        createGrid();
    </script>
</body>
</html>